<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<meta name="viewport"
	content="width=device-width, initial-scale=1, shrink-to-fit=no">
<script src="https://cdn.tiny.cloud/1/no-api-key/tinymce/5/tinymce.min.js" referrerpolicy="origin"></script>
<link th:href="@{/css/modal/select2.css}" rel="stylesheet">
<script
	src="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/js/select2.min.js"></script>
 <script>tinymce.init({selector:'#causa'});</script>
 <script>tinymce.init({selector:'#consecuencias'});</script>
</head>
<body>
<div class="col-lg-12 col-md-12">
	<form action="" id="agregarReconocimientoProblematica" th:object="${pddProblematica}">
	<div class="form-group">
	<input type="hidden" id="idProblematicaRec" name="idProblematica">
		<input type="hidden" id="idCompromisoRec" name="idCompromiso">
		<input type="hidden" id="problematicaRec" name="problematica"> 
		<div class="texto">
			<label for="periodo">Descripción de las situaciones
				problemáticas *</label>
		</div>
		<textarea class="form-control" name="descripcion" id="descripcion" maxlength="2000"
			required rows="2" placeholder="Longitud 2000"></textarea>
	</div>
</div>
<div class="col-lg-12 col-md-12">
	<div class="form-group">
		<div class="texto">
			<label for="periodo">Poblaciones y actores involucrados</label>
		</div>
		<button type="button" class="boton-agregar" id="agregarPoblacion"
			onclick="abrirPoblacion()">
			<i class="fa fa-plus-circle"></i> Agregar
		</button>
		<br> <br>
		
		<div class="table-responsive">
			<table id="dtablaPoblacion" class="table-striped" style="width: 175%">
				<thead>
					<tr class="color">
						<th style="width: 10%;" class="color-head">Poblaciones y actores<br></th>
						<th style="width: 12%;" class="color-head">Acción</th>
					</tr>
				</thead>
				<tbody>
					

				</tbody>
			</table>
		</div>
	</div>
</div>
</body>
<div class="col-lg-12 col-md-12">
	<div class="form-group">
		<div class="texto">
			<label for="periodo">Localización del problema</label>
		</div>
	</div>
	<div class="row">
		<div class="col-lg-4 col-md-4">
			<div class="form-group">
				<div class="texto">
					<label for="codigo_comp">Localización: *</label>
				</div>
				<select style="width: 100% !important"
				class="form-control js-example-basic-single" name="idLsLocalizacion" id="idLsLocalizacion">
				<option value="">Seleccione Una opcion</option>
				<option th:each="localizacion : ${localizacion}"
				th:value="${localizacion.idArgumento}"
				th:text="${localizacion.resultado}">
			</select>
			</div>
		</div>
		
		<div class="col-lg-4 col-md-4">
			<div class="form-group">
				<div class="texto">
					<label for="codigo_comp">Sublocalización: *</label>
				</div>
				<select style="width: 100% !important"
				class="form-control js-example-basic-single" name="idLsSublocalizacion" id="idLsSublocalizacion">
				<option value="">Seleccione Una opcion</option>
			</select>
			</div>
		</div>
		
		<div class="col-lg-4 col-md-4">
			<div class="form-group">
				<div class="texto">
					<label for="codigo_comp">UPZ/ UPR: *</label>
				</div>
				<select style="width: 100% !important"
				class="form-control js-example-basic-single" name="idLzUpzUpr" id="idLzUpzUpr">
				<option value="">Seleccione Una opcion</option>
				
				
			</select>
			</div>
		</div>
	</div>
</div>
	<div class="col-lg-12 col-md-12">
	<div class="form-group">
		<div class="texto">
			<label for="periodo">Causas que originan el problema *</label>
		</div>
		 <textarea id="causa" placeholder="Longitud 2000" name="causas"></textarea>
		</div>
     </div>
     
	<br>
	<div class="col-lg-12 col-md-12">
	<div class="form-group">
		<div class="texto">
			<label for="periodo">Consecuencias o efectos que produce el problema *</label>
		</div>
		<textarea id="consecuencias" placeholder="Longitud 2000" name="consecuencias"></textarea>
		</div>
     </div>
		<div align="right">
			<button type="submit"
					class="boton-regresar">
					<i class="fa fa-save" id="volver"></i>Guardar
				</button>
		</div>
	</form>

	<div
		th:include="ip/analisis-politica/modales/modal-agregar-poblacion.html"></div>
		<div
		th:include="ip/analisis-politica/modales/modal-editar-poblacion.html"></div>
<script th:inline="javascript">
$(document).ready(function() {
	 
	 $('.js-example-basic-single').select2({
			minimumResultsForSearch : Infinity
		});
	
	

	$('#idLsLocalizacion').change(function() {
		var dato=($(this).val());
		/*<![CDATA[*/
		 var localizacion = /*[[${localizacion}]]*/;	
		 var localidades = /*[[${localidades}]]*/;	
		 
		 for (var i = 0; i < localizacion.length; i++) {
			 var select = document.getElementById("idLsSublocalizacion");
			 var select2 = document.getElementById("idLzUpzUpr");
			 select.innerHTML = '<option value="">Seleccione una opcion</option>';
			 select2.innerHTML = '<option value="">Seleccione una opcion</option>';
			if(dato==localizacion[i].idArgumento && localizacion[i].resultado==='Localidad'){
				 for (var j = 0; j < localidades.length; j++) {
					 let opcion = document.createElement('option')
		        		
	        		 opcion.value = localidades[j].idArgumento;
	        		 opcion.text = localidades[j].resultado;
	        	     select.add(opcion);
				}
			}
		}
		
		
	});
	
	$('#idLsSublocalizacion').change(function() {
		var idLocalidad = $(this).val();
		console.log(idLocalidad);
		var listaTerritorializacion = /*[[${listaTerritorializacion}]]*/;
		var selectUpr = document.getElementById("idLzUpzUpr");
		selectUpr.innerHTML = '<option value="">Seleccione una opcion</option>'
		for (var i = 0; i < listaTerritorializacion.length; i++) {
			if(listaTerritorializacion[i].idLsLocalidad==idLocalidad){
				
       	
       		 	let opcion = document.createElement('option');
				if(listaTerritorializacion[i].idLsUpz==-1){
					opcion.value = listaTerritorializacion[i].idLsUpr;
  	        		 opcion.text = listaTerritorializacion[i].nombreUpr;
  	        		selectUpr.add(opcion);
				}else{
					opcion.value = listaTerritorializacion[i].idLsUpz;
 	        		 opcion.text = listaTerritorializacion[i].nombreUpz;
 	        		selectUpr.add(opcion);
				}
			}
		}
	})
	 
	/*]]>*/  
	
	function obtenerTerritorios(idLocalidad){
		 var data = $(this).serialize();
		 $.ajax({
			
			 type: 'GET',
             url: '/Segplan/'+'obtener-territorios-localidad/'+idLocalidad,
             data: data,
             success: function (data) {
           		console.log(data);
           		for (var i = 0; i < data.lstObjectsDTO; i++) {
           			var selectUpr = document.getElementById("upr");
           			var selectUpz = document.getElementById("upz");
           		 let opcion = document.createElement('option')
           			if(data.lstObjectsDTO[i].idLsUpz==-1){
           			
           			opcion.value = localidades[j].idLsUpr;
   	        		 opcion.text = localidades[j].nombreUpr;
   	        		selectUpr.appendChild(opcion);
           			}else{
           				opcion.value = localidades[j].idLsUpz;
      	        		 opcion.text = localidades[j].nombreUpz;
      	        		selectUpz.appendChild(opcion);
           			}
				}
             }
		 });
		 
			
	}
	
});
function abrirPoblacion(){
	$('#modalAbrirPoblacion2').modal('show');
	$('#descripcion').val('');
}
function editarCompromisoEspecifico(descripcion,idEspecifico){
	$('#modalEditarEspecifico').modal('show');
	 document.getElementById("descripcionEspecifico").value = descripcion;
	 document.getElementById("compromisoIdEspecificoEditar").value = idEspecifico;
	 
}
function eliminarCompromisoEspecifico(idEspecifico){
	Swal.fire({
		  title: '¡Advertencia!',
		  text: "¿Está seguro de eliminar este compromiso específico?",
		  icon: 'warning',
		  showCancelButton: true,
		  confirmButtonColor: '#3085d6',
		  cancelButtonColor: '#d33',
		  confirmButtonText: 'Aceptar',
		  cancelButtonText: 'Cancelar'
		}).then((result) => {
		  if (result.value) {
			window.location = "eliminar-especifico/" + idEspecifico;  
		  
		  }
		})
}



</script>
</html>