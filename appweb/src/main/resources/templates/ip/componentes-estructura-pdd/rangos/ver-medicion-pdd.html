<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:include="/header :: headFragment">
<meta charset="UTF-8">

<title id="pageTitle">Medición</title>
</head>
<link rel="stylesheet" type="text/css" th:href="@{/css/afs/archivo-plano.css}">
<link rel="stylesheet" type="text/css" th:href="@{/css/ip/componentes.css}">
<link rel="stylesheet" type="text/css" th:href="@{/css/bp/tab-cadena.css}">
<link rel="stylesheet" type="text/css" th:href="@{/css/ip/logo.css}">
<link rel="stylesheet" type="text/css" th:href="@{/css/bp/taps-proyectos.css}">
<link rel="stylesheet" type="text/css" th:href="@{/css/modal/modal.css}">
<link rel="stylesheet" type="text/css" th:href="@{/css/afs/listas.css}">
<body>
	<header th:replace="/home:: header"></header>
	<ul class="breadcrumb" id="migas">
		<li class="breadcrumb-item"><em class="fa fa-home">&nbsp;&nbsp;|&nbsp;&nbsp;</em>Instrumentos de planeación</li>
		<li class="breadcrumb-item " aria-current="page">Estructura plan de Desarrollo</li>
		<li class="breadcrumb-item " aria-current="page"><a th:href="@{/estructura-pdd/2}">Componentes de la estructura PDD</a></li>
		<li class="breadcrumb-item active" aria-current="page" id="act">Consultar rangos de medición</li>
	</ul>
	<div class="form-container3">
		<div class="row mt-3">
			<div class="col-sm-3 mt-2">
				<div class="texto">
					<label>Código del PDD:</label>
				</div>

			</div>
			<div class="col-sm-2">
				<input type="text" class="form-control" readonly="readonly"
					th:value="${pddDTO.idPlanDesarrollo}" id="idPddBalanceo">
			</div>
		</div>
		<div class="row mt-3">
			<div class="col-sm-3 mt-2">
				<div class="texto">
					<label>Plan de Desarrollo Distrital</label>
				</div>

			</div>
			<div class="col-sm-8">
				<input type="text" class="form-control" readonly="readonly"
					th:value="${pddDTO.nombrePlan}" id="idPlanBalanceo">
			</div>
		</div><br>
		<div class="abs-center">
			<span>Rangos de medición</span><br>
		</div>
		<div class="hr-1"></div>
		<br>
		
		<div class="float-left">

			<button class="boton-agregar mt-3" type="button" id="botonAgregar">
				<img src="css/img/icono-agregar.png" class="agregar" alt="Icono agregar">Agregar
			</button>
<!-- 		<img src="data:image/png;base64," /> -->
		</div><br><br><br>
		<form id="peticionEliminar" th:action="@{/eliminar-rango}" method="post" th:object="${pddpddRangoPonderacionDTO}">
		<input type="hidden" id="idRangoPeticion" name="idRango">
		</form>
		<div class="table-responsive">
			<table class="table-striped" id="dtablaRangos" style="width: 175%">
				<thead>
					<tr>
						
						<th style="width: 25%;" class="color-head">Logo<br></th>
						<th style="width: 25%;" class="color-head">Rangos<br></th>
						<th style="width: 25%;" class="color-head">Descripción<br></th>
						<th style="width: 10%;" class="color-head">Acción<br></th>
					</tr>
				</thead>
				<tbody>
				
				</tbody>
			</table>
		</div>
	</div><br><br>
	<footer th:replace="/home:: footer"></footer>
	<div th:include="ip/componentes-estructura-pdd/componentes/modales/modal-agregar-rango.html"></div>
	<script th:inline="javascript">
	
	
	
	$(document).ready(function() {
		/*<![CDATA[*/
		var rangos =/*[[${rangos}]]*/;
		var respuesta = /*[[${respuesta}]]*/;
		console.log(rangos);
		for (var i = 0; i < rangos.length; i++) {
			var contenido = '<tr>'
			contenido+='<td><img class="logo" src="data:image/png;base64,'+rangos[i].imagen+'" /></td>';
			contenido+='<td>'+rangos[i].rango+'</td>';
			contenido+='<td>'+rangos[i].descripcion+'</td>';
			contenido+='<td><button href="" type="button" id="ButtonEditar" class="edit"><img src="css/img/icono-1-azul.png" class="editar"></button><button href="" type="button" id="ButtonEliminar" class="edit"><img src="css/img/icono-eliminar.png" class="eliminar"></button><input type="hidden" id="idRango" value="'+rangos[i].idRango+'""></td></tr>';
			$('#dtablaRangos').append(contenido);
		}
		if(respuesta!=null){
			Swal.fire({
		        title: 'Información',
		        text: respuesta,
		        icon: 'info',
		        confirmButtonText: 'Aceptar',
		        allowOutsideClick: () => false
		  });
		}
		
		/*]]>*/
		$('#file_1').on('change',function(){
             	
             	 $('#inputval').text($(this).get(0).files.item(0).name);
            });
		$('#botonAgregar').click(function() {
			$('#rango1').val('');
			$('#rango2').val('');
			$('#rango3').val('');
			$('#rango4').val('');
			$('#idRango2').val('');
			$('#descripcion').val('');
			$('#agregarMedicion').modal('show');
		})
		$('#dtablaRangos').on('click','#ButtonEditar',function() {
			var id = $(this).parent().find('#idRango');
			var id2 =$(id).val(); 
			$('#idRango2').val(id2);
			var rango =$(this).parent().parent().find('td');
			var textRango='';
			var descripcion='';
			for (var i = 0; i < rango.length; i++) {
				textRango = $(rango[1]).text();
				descripcion = $(rango[2]).text();
			}
			$('#descripcion').val(descripcion);
			var rangos = '';
			if(textRango.length <= 4){
				
				if(textRango[0]=== '<'){
					if(textRango[1]==='='){
						
						var valor = textRango[0]+textRango[1];
						
						$('#rango3').val(valor);
						var cadena = textRango.slice(2,4);
						console.log(cadena);
					}else{
						var valor = textRango[0];
						$('#rango3').val(valor);
						var cadena = textRango.slice(1,3);
						$('#rango4').val(cadena);
						console.log(cadena);
					}
				}
				if(textRango[0]=== '>'){
					if(textRango[1]==='='){
						
						var valor = textRango[0]+textRango[1];
						
						$('#rango1').val(valor);
						var cadena = textRango.slice(2,4);
						
					}else{
						var valor = textRango[0];
						$('#rango1').val(valor);
						var cadena = textRango.slice(1,3);
						$('#rango2').val(cadena);
						console.log(cadena);
					}
				}
			}else{
				if(textRango[0]=== '>'){
					if(textRango[1]==='='){
						
						var valor = textRango[0]+textRango[1];
						
						$('#rango1').val(valor);
						var cadena = textRango.slice(2,4);
						$('#rango2').val(cadena);
					}else{
						var valor = textRango[0];
						$('#rango1').val(valor);
						var cadena = textRango.slice(1,3);
						$('#rango2').val(cadena);
						console.log(cadena);
					}
				
				}
				if(textRango[5]=== '<'){
					if(textRango[6]==='='){
						
						var valor = textRango[5]+textRango[6];
						
						$('#rango3').val(valor);
						var cadena = textRango.slice(7,9);
						$('#rango4').val(cadena);
					}else{
						var valor = textRango[5];
						$('#rango3').val(valor);
						var cadena = textRango.slice(6,7);
						$('#rango4').val(cadena);
						console.log(cadena);
					}
				}
				
			}
			$('#agregarMedicion').modal('show');
		})
		$('#dtablaRangos').on('click','#ButtonEliminar',function() {
			var id = $(this).parent().find('#idRango');
			
			Swal.fire({
				  
				  text: "Está seguro que desea eliminar este registro?",
				  icon: 'warning',
				  showCancelButton: true,
				  confirmButtonColor: '#3085d6',
				  cancelButtonColor: '#d33',
				  confirmButtonText: 'Borrar',
				  cancelButtonText:'Cancelar',
				}).then((result) => {
				  if (result.value) {
				    		var id2 =$(id).val(); 
					  		$('#idRangoPeticion').val(id2);
							$('#peticionEliminar').submit();
				    
				  }
				})
			
		
			
		})
		 var tableAsignarEntidad = $('#dtablaRangos').DataTable({
			 
		        "language": {
		            "info": '<div class="formato">_END_ de _TOTAL_ registros</div>',
		            "infoEmpty": '<div class="formato">0 de 0.</div>',
		            "infoFiltered": "(filtrados de un total de _MAX_ registros)",
		            "zeroRecords": "No se han encontrado coincidencias.",
		            "responsive": true,
		            "paginate": {
		                "first": '<img src="css/img/icono-flecha-doble-izquierda.png" class="flecha-paginador">',
		                "last":  '<img src="css/img/icono-flecha-doble-derecha.png" class="flecha-paginador">',
		                "next": '<img src="css/img/icono-flecha-derecha.png" class="flecha-paginador">',
		                "previous":'<img src="css/img/icono-flecha-izquierda.png" class="flecha-paginador">'
		            },
		            "lengthMenu": "_MENU_",
		        },
		        "lengthMenu": [5, 10, 20, 50, 100],
		        "pageLength": 5,
		        "pagingType": "full_numbers",
		        "dom": "<'row'<'col-sm-5 col-md-7'>>" +
		                "<'row'<'col-sm-8 col-md-7'tr>>" +
		                "<'row'<'col-sm-8 col-md-7'><'col-sm-2 col-md-1'l><'col-sm-1 col-md-1'i><'col-sm-1 col-md-3'p>>",

		    });
		    $('div.dataTables_length select').addClass("formato-2");
		    $('#dtablaRangos  thead th').each( function () {
		        var title = $(this).text();
		        if (title !== "Acción" && title!=="Logo") {
		        $(this).html( '<div class="form-group" id="centrado2">' + '<label for="th" class="blanco">' + title + '</label>' + '<div class="centrado">' + '<input class="form-control filter" id="nombre1" type="text"  placeholder="&#xf0b0; Filtrar ' + title + '" />' + '</div>' + '</div>' );
		        }
		    } );
		    tableAsignarEntidad.columns().every(function () {
		        var that = this;

		        $('input', this.header()).on('keyup change clear', function () {
		            if (that.search() !== this.value) {
		                that
		                        .search(this.value)
		                        .draw();
		            }
		        });
		    });
		    $('.filter').on('click', function(e) {
				e.stopPropagation();
			});
	})
	</script>
	<script type="text/javascript"
		th:src="@{/js/src/jquery.dataTables.yadcf.js}"></script>
	<script type="text/javascript" th:src="@{/js/nhspdd/home.js}"></script>
	<script type="text/javascript" th:src="@{/js/src/bootstrap.min.js}"></script>
</body>
</html>