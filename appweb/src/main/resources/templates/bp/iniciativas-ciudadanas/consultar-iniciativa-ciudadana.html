<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head th:include="/header :: headFragment">
<meta charset="UTF-8">
<title id="pageTitle">Consultar iniciativas ciudadanas</title>
</head>
<link rel="stylesheet" type="text/css" th:href="@{/css/afs/listas.css}">
<link rel="stylesheet" type="text/css"
	th:href="@{/css/afs/archivo-plano.css}">

<link rel="stylesheet" type="text/css" th:href="@{/css/filtros/yadcf-consultar-ic.css}">
<body>
	<header th:replace="/home:: header"></header>

	<nav aria-label="breadcrumb">
		<ul class="breadcrumb" id="migas">
			<li class="breadcrumb-item"><em class="fa fa-home">&nbsp;&nbsp;|&nbsp;&nbsp;</em><a
				href="">Banco distrital de programas y proyectos</a></li>
			<li class="breadcrumb-item active" aria-current="page" id="act">Iniciativa
				ciudadana</li>

		</ul>
	</nav>

	<div class="form-container3">

		<div class="abs-center">
			<span>Iniciativa ciudadana</span><br>
		</div>
		<div class="hr-1"></div>

		<div class="float-left">
			<a th:href="@{/crear-iniciativa}">
				<button class="boton-agregar mt-3">
					<img src="css/img/icono-agregar.png" class="agregar"
						alt="Icono agregar"> Agregar
				</button>
			</a>
		</div>
		<br><br><br>
		<form method="post" th:action="@{/modificar-iniciativa}" th:object="${iniciativaDTO}" id="peticionEditar">
		<input type="hidden" name="idIniciativa" id="idIniciativa">
		</form>
		<form method="post" th:action="@{/eliminar-iniciativa}" th:object="${iniciativaDTO}" id="peticionEliminar">
		<input type="hidden" name="idIniciativa" id="idIniciativa2">
		</form>
		<form th:action="@{/ver-consultar-detallada-iniciativa}" th:object="${iniciativaDTO}" id="peticionDetallada" method="post">
		<input type="hidden" name="idIniciativa" id="idIniciativa3">
		</form>
		<div class="table-responsive">
			<table id="tablaIniciativa" class="table-striped" style="width: 400%">
			<caption><div class="hr-2"></div></caption>
				<thead>
					<tr class="color">
						<th style="width: 20%;" class="color-head">Alcadía local<br></th>
						<th style="width: 5%;" class="color-head">Código<br></th>
						<th style="width: 20%;" class="color-head">Plan de desarrollo distrital<br></th>
						<th class="color-head">Fecha de Registro<br></th>
						<th class="color-head">Número de radicado<br></th>
						<th class="color-head">Fecha Radicado<br></th>
						<th style="width: 15%;" class="color-head">Sector<br></th>
						<th style="width: 20%;" class="color-head">Linea de Inversión<br></th>
						<th class="color-head">Estado de la iniciativa<br></th>
						<th class="color-head">Código proyecto<br></th>
						<th style="width: 5%;"><div class="subir">Acción</div></th>
					</tr>

				</thead>

				<tbody>
				</tbody>

			</table>
		</div>

	</div>
     	<br>
		<footer th:replace="/home:: footer"></footer>

</body>
<script th:inline="javascript">
$(document).ready(function() {
	/*<![CDATA[*/
	cargarDatos();	
	var msgRespuesta = /*[[${messageRespuesta}]]*/;
	if(msgRespuesta!=null){
		 Swal.fire({
		        title: 'Información',
		        text: msgRespuesta,
		        icon: 'info',
		        confirmButtonText: 'Aceptar',
		        allowOutsideClick: () => false
		  })
		 
	}
	/*]]>*/
});
function cargarDatos() {
	  'use strict';
		var table = $('#tablaIniciativa').DataTable({
	    "colReorder" : true,
		"processing" : true,
		"serverSide" : true,
		"lengthChange" : true,
		"searching" : true,
		"ordering" : true,
		"info" : true,
		"autoWidth" : true,
		"lengthMenu" : [ [ 5, 10, 25, 50, -1 ],[ 5, 10, 25, 50, "Mostrar Todo" ] ],
		"pageLength" : 5,
		"language" : {
			"processing" : 'Cargando...',
			"info" : '<div class="formato">_END_ de _TOTAL_ registros</div>',
			"infoEmpty" : '<div class="formato">0 de 0.</div>',
			"infoFiltered" : "(filtrados de un total de _MAX_ registros)",
			"zeroRecords" : "No se han encontrado coincidencias.",
			"responsive" : true,
			"paginate" : {
				"first" : '<img src="css/img/icono-flecha-doble-izquierda.png" class="flecha-paginador">',
				"last" : '<img src="css/img/icono-flecha-doble-derecha.png" class="flecha-paginador">',
				"next" : '<img src="css/img/icono-flecha-derecha.png" class="flecha-paginador">',
				"previous" : '<img src="css/img/icono-flecha-izquierda.png" class="flecha-paginador">'
			},
			"lengthMenu" : "_MENU_",
		},
		"pagingType" : "full_numbers",
		"dom" : "<'row'<'col-sm-5 col-md-7'>>"
				+ "<'row'<'col-sm-8 col-md-7'tr>>"
				+ "<'row'<'col-sm-8 col-md-7'><'col-sm-2 col-md-1'l><'col-sm-1 col-md-1'i><'col-sm-1 col-md-3'p>>",
		"ajax" : {
					"url" : "/Segplan/listaIniciativaCiudadanaByPage",
					"type" : "POST"
		 },
		 
		 "columns" : [
				{ data : "nombreEntidad"},
				{ data : "codigoIn"},
				{ data : "nombrePlanDesarrollo" },
				{ data : "fechaCodigo" },
				{ data : "numeroRad" },
				{ data : "fechaRad"},
				{ data : "nombreSector" },
				{ data : "nombreLineaInversion" },
				{ data : "nombreEstado" },
				{ data : "codigoProyectoInversion" },
				{
					"render" : function() {
						return '<button  type="button" id="BtnEditar" class="edit"><img src="css/img/icono-1-azul.png" class="editar"></button><button  type="button" id="BtnEliminar" class="edit"><img src="css/img/icono-eliminar.png" class="editar"></button><button  type="button" id="BtnDetallada" class="edit"><img src="css/img/icono-lupa.png" class="editar"></button>'
												
					},  "orderable": false,  className:"icon"
				},],	
})
yadcf.init(table, [ {
	column_number : 0,
	filter_type : "text",
	filter_reset_button_text : false,
	filter_delay : 500

}, {
	column_number : 1,
	filter_type : "text",
	filter_reset_button_text : false,
	filter_delay : 500
}, {
	column_number : 2,
	filter_type : "text",
	filter_reset_button_text : false,
	filter_delay : 500
}, {
	column_number : 3,
	filter_type : "text",
	filter_reset_button_text : false,
	filter_delay : 500
}, { 
	column_number : 4,
	filter_type : "text",
	filter_reset_button_text : false,
	filter_delay : 500
}, {
	column_number : 5,
	filter_type : "text",
	filter_reset_button_text : false,
	filter_delay : 500
} , {
	column_number : 6,
	filter_type : "text",
	filter_reset_button_text : false,
	filter_delay : 500
} , {
	column_number : 7,
	filter_type : "text",
	filter_reset_button_text : false,
	filter_delay : 500
}, {
	column_number : 8,
	filter_type : "text",
	filter_reset_button_text : false,
	filter_delay : 500
}, {
	column_number : 9,
	filter_type : "text",
	filter_reset_button_text : false,
	filter_delay : 500

}]);
   $('div.dataTables_length select').addClass("formato-2");	
   editar('#tablaIniciativa tbody', table); 
   eliminar('#tablaIniciativa tbody', table);
   detallada('#tablaIniciativa tbody', table);
}
function editar(tbody, table) {
	$(tbody)
			.on("click",
					"button#BtnEditar",
					function() {
						if (table.row(this).child.isShown()) {
							var data = table.row(this).data();
						} else {
							var data = table.row($(this).parents("tr"))
									.data();
						}
						var data = table.row($(this).parents("tr")).data();
						console.log(data);
						console.log("entro");
						document.getElementById('idIniciativa').value=data.idIniciativa;
						$('#peticionEditar').submit();
					})
}
function detallada(tbody, table) {
	$(tbody)
			.on("click",
					"button#BtnDetallada",
					function() {
						if (table.row(this).child.isShown()) {
							var data = table.row(this).data();
						} else {
							var data = table.row($(this).parents("tr"))
									.data();
						}
						var data = table.row($(this).parents("tr")).data();
						console.log(data);
						
						document.getElementById('idIniciativa3').value=data.idIniciativa;
						$('#peticionDetallada').submit();
					})
}
function eliminar(tbody, table) {
	$(tbody)
			.on("click",
					"button#BtnEliminar",
					function() {
						if (table.row(this).child.isShown()) {
							var data = table.row(this).data();
						} else {
							var data = table.row($(this).parents("tr"))
									.data();
						}
						var data = table.row($(this).parents("tr")).data();
						console.log(data);
						Swal.fire({
							  
							  text: "Está seguro de eliminar la iniciativa ciudadana seleccionada?",
							  icon: 'warning',
							  showCancelButton: true,
							  confirmButtonColor: '#3085d6',
							  cancelButtonColor: '#d33',
							  confirmButtonText: 'Borrar',
							  cancelButtonText:'Cancelar',
							}).then((result) => {
							  if (result.value) {
							    
							    		document.getElementById('idIniciativa2').value=data.idIniciativa;
										$('#peticionEliminar').submit();
							    
							  }
							})
						
					})
}
</script>
<script type="text/javascript"
	th:src="@{/js/src/jquery.dataTables.yadcf.js}"></script>
<script type="text/javascript" th:src="@{/js/nhspdd/home.js}"></script>
<script type="text/javascript" th:src="@{/js/src/bootstrap.min.js}"></script>
</html>