<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head th:include="/header :: headFragment">
<meta charset="UTF-8">
<title id="pageTitle">Equipamientos</title>
</head>
<link rel="stylesheet" type="text/css" th:href="@{/css/afs/listas.css}">
<link rel="stylesheet" type="text/css" th:href="@{/css/modal/modal.css}">
<link rel="stylesheet" type="text/css" th:href="@{/css/filtros/yadcf-listas-eq.css}">
<link th:href="@{/css/modal/select2.css}" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/js/select2.min.js"></script>
<body>

	<header th:replace="/home:: header"></header>
	<nav aria-label="breadcrumb">
		<ul class="breadcrumb" id="migas">
			<li class="breadcrumb-item"><em class="fa fa-home">&nbsp;&nbsp;|&nbsp;&nbsp;</em><a
				>Administracion funcional</a></li>
			<li class="breadcrumb-item">Entidades, tablas, párametros y consecutivos</li>
			<li class="breadcrumb-item" aria-current="page"><a th:href="@{/consultar_lista_compuesta}">Listas compuestas</a></li>
			<li class="breadcrumb-item active" aria-current="page" id="act">Equipamiento</li>	
		</ul>
	</nav>

	<div class="form-container3">

		<div class="abs-center">
			<span>Equipamientos</span><br>
		</div>
		<div class="hr-1"></div>
		<br>
		<div class="float-left">
			<button type="button" class="boton-agregar"
				th:onClick="crearEquipamiento()">
				<img src="css/img/icono-agregar.png" class="agregar" alt="Icono agregar">Agregar
			</button>
		</div>
		<br>
		<br>
		<div class="table-responsive">
			<table id="dtabla" class="table-striped" style="width:250%">
			<caption><div class="hr-2"></div></caption>
				<thead>
					<tr class="color">
						<th id=""  class="color-head">Código<br></th>
						<th id="veinte" class="color-head">Nombre equipamiento<br></th>
						<th id="treinta" class="color-head">Descripción<br></th>
						<th id="quince" class="color-head">Sector<br></th>
						<th id="quince" class="color-head">Categoría<br></th>
						<th id="diez" class="color-head">Estado<br></th>
						<th id="cinco" class="color-head">Acción</th>
					</tr>
				</thead>
				<tbody>
				</tbody>
			</table>
		</div>

		<div class="float-right">
			<a th:href="@{/consultar_lista_compuesta}"><button type="button"
					class="boton-regresar">
					<img src="css/img/volver-over.png" class="volver" alt="Icono volver">&nbsp;&nbsp;Volver
				</button></a>
		</div>
		<br>
	</div>
	<br>
	<br>
	<footer th:replace="/home:: footer"></footer>
	<div th:include="afs/listas/modal-editar-eq.html"></div>
	<div th:include="afs/listas/modal-agregar-eq.html"></div>
	<div th:include="afs/autenticacion/modal-cambiar-contrasena.html"></div>

</body>
<script th:inline="javascript">
	$(document).ready(function() {
		
		 /*<![CDATA[*/
		 var mensajeRes = /*[[${messageRespuesta}]]*/;
		
			
		   if (mensajeRes != null){
		   Swal.fire({
				        title: 'Información',
				        text: mensajeRes,
				        icon: 'warning',
				        confirmButtonText: 'Aceptar',
				        allowOutsideClick: () => false
				    })
				    
	}
		     
		/*]]>*/
		
		
		cargarDatos();
		 $('#dtabla tbody').on('mouseover','tr',function(){
	    	    $(this).find('.icon').find('.edit').find('.editar').attr("src","css/img/editar-rollover.png");
	    		});
	    	    $('#dtabla tbody').on('mouseleave','tr',function(){
	    	    $(this).find('.icon').find('.edit').find('.editar').attr("src","css/img/icono-1-azul.png") ;		 	 
	    		 });	
	});
	function crearEquipamiento() {
		document.getElementById("nombreEq").value = "";
		document.getElementById("descripcionEq").value = "";
		document.getElementById("idLsSectorEq").value = "";
		document.getElementById("idLsCategoriaEq").value = "";
		$('#crearEquipamientoModal').modal('show');
	}
   function cargarDatos(){
		'use strict';
		var opts = [{value:1, label:"Activo"},{value:0, label:"Inactivo"}];
		$.fn.DataTable.ext.pager.numbers_length = 5;
		var table = $('#dtabla').DataTable({
			"colReorder" : true,
			"processing" : true,
			"serverSide" : true,
            "lengthChange": true,
            "searching": true,
            "orderable":true,
            "orderMulti":true,
            "ordering": true,
            "info": true,
            "autoWidth": true,
            "lengthMenu": [ [5, 10, 25, 50, -1], [5, 10,25, 50, "Mostrar Todo"] ],
            "pageLength": 5,
		    "language": {
		    	"processing": 'Cargando...',
	            "info": '<div class="formato">_END_ de _TOTAL_ registros</div>',
	            "infoEmpty": '<div class="formato">0 de 0.</div>',
	            "infoFiltered": "(filtrados de un total de _MAX_ registros)",
	            "zeroRecords": "No se han encontrado coincidencias.",
	            "responsive": true,
	            "paginate": {
	                "first": '<img src="css/img/icono-flecha-doble-izquierda.png" class="flecha-paginador">',
	                "last":  '<img src="css/img/icono-flecha-doble-derecha.png" class="flecha-paginador">',
	                "next": '<img src="css/img/icono-flecha-derecha.png" class="flecha-paginador">',
	                "previous":'<img src="css/img/icono-flecha-izquierda.png" class="flecha-paginador">'
	            },
	            "lengthMenu": "_MENU_",
	        },
	        "pagingType": "full_numbers",
	        "dom": "<'row'<'col-sm-5 col-md-7'>>" +
	        "<'row'<'col-sm-8 col-md-7'tr>>" +
	        "<'row'<'col-sm-8 col-md-7'><'col-sm-2 col-md-1'l><'col-sm-1 col-md-1'i><'col-sm-1 col-md-3'p>>",
	        "order": [0,'desc'],
			"ajax" : {
				"url" : "/Segplan/listaEquipamientoByPage",
				"type" : "POST"
			},
		
			"columns" : [ 
				{ data : "idEquipamento","name":"idEquipamento", className: 'derechaPresupuesto'},
				{ data : "nombre","name":"nombre"},
				{ data : "descripcion"},
				{ data : "nombreSector"},
				{ data : "nombreCategoria"},
				{ data : "stringEstado"},
			    {"render": function () {
			        return '<button href="" type="button" id="ButtonEditar" class="edit"><img src="css/img/icono-1-azul.png" class="editar"></button>';
			    }, "orderable": false, className:"icon"},
               ]
		})
		yadcf.init(table, [ {
			column_number : 0,
			filter_type : "text",
			filter_reset_button_text: false,
			filter_delay : 500
			
		}, {
			column_number : 1,
			filter_type : "text",
			filter_reset_button_text: false,
			filter_delay : 500
		},
		{
			column_number : 2,
			filter_type : "text",
			filter_reset_button_text: false,
			filter_delay : 500
		},
		{
			column_number : 3,
			filter_type : "text",
			filter_reset_button_text: false,
			filter_delay : 500
		},
		{
			column_number : 4,
			filter_type : "text",
			filter_reset_button_text: false,
			filter_delay : 500
		},
		{ 
			data: opts,
			column_number: 5,
	        select_type: 'select',
	        filter_reset_button_text: false,
	        select_type_options: {
	            width: '150px',
	            minimumResultsForSearch: -1 // remove search box
	        }
			
		}
		]);
		$('div.dataTables_length select').addClass("formato-2");
		editar("#dtabla tbody",table);

   }
	function editar(tbody, table){
		$(tbody).on("click","button.edit", function(){
		    if(table.row(this).child.isShown()){
		        var data = table.row(this).data();
		    }else{
		        var data = table.row($(this).parents("tr")).data();
		    }
		    var data = table.row($(this).parents("tr")).data();
		    editarEquipamiento(data.idEquipamento, data.nombre, data.descripcion, data.idLsSector,
		    		data.idLsCategoria, data.estado);
		  })
	}
	function editarEquipamiento(id, nombre, descripcion, sector, categoria, estado) {
		$('#editarEquipamientoModal').modal('show');
		$('#idEquipamento').text($('#idEquipamento').val(id));
		$('#nombre_eq').text($('#nombre_eq').val(nombre));
		$('#descripcion_eq').text($('#descripcion_eq').val(descripcion));
		$('#estado').text($('#estado').val(estado));
		document.getElementById("idLsSector").value = sector;
		document.getElementById("idLsCategoria").value = categoria;
		$("#idLsSector").val(sector).trigger('change');
		$("#idLsCategoria").val(categoria).trigger('change');
		var est = document.getElementById("estado").value;
	      
		if (est == 1) {
			$("input[type=checkbox]").prop("checked", true);

		} else if (est == 0) {
			$("input[type=checkbox]").prop("checked", false);
		}
	}
</script>
    <script type="text/javascript"
	th:src="@{/js/src/jquery.dataTables.yadcf.js}"></script>
<script type="text/javascript" th:src="@{/js/nhspdd/home.js}"></script>
<script type="text/javascript" th:src="@{/js/src/bootstrap.min.js}"></script>
</html>