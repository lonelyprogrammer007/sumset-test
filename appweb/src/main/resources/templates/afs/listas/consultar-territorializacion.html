<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head th:include="/header :: headFragment">
<meta charset="UTF-8">
<title id="pageTitle">Consultar territorialización</title>
</head>
<link rel="stylesheet" type="text/css" th:href="@{/css/afs/listas.css}">
<link rel="stylesheet" type="text/css" th:href="@{/css/filtros/yadcf-listas-territorializacion.css}">
<link rel="stylesheet" type="text/css" th:href="@{/css/modal/modal.css}">
<body>

	<header th:replace="/home:: header"></header>

	<nav aria-label="breadcrumb">
		<ul class="breadcrumb" id="migas">
			<li class="breadcrumb-item"><em class="fa fa-home">&nbsp;&nbsp;|&nbsp;&nbsp;</em><a
				>Administración funcional</a></li>
			<li class="breadcrumb-item">Entidades, tablas, párametros y consecutivos</li>	
			<li class="breadcrumb-item" aria-current="page"><a th:href="@{/consultar_lista_compuesta}">Listas compuestas</a></li>
			<li class="breadcrumb-item active" aria-current="page" id="act">Territorialización</li>	
		</ul>
	</nav>
	<div class="form-container3">
		<div class="abs-center">
			<span>Territorialización</span><br>
		</div>
		<div class="hr-1"></div>
		<br>
		<div class="float-left">
			<button type="button" class="boton-agregar"
				th:onClick="crearTerritorializacion()">
				<img src="css/img/icono-agregar.png" class="agregar" alt="Icono agregar"> Agregar
			</button>
		</div>
		<br><br></br>
		<div class="table-responsive">
			<table id="dtabla" class="table-striped" style="width:310%">
			
			<caption><div class="hr-2"></div></caption>
				<thead>
					<tr class="color">
                        <th id="cinco" class="color-head">Código<br></th>
						<th id="veinte" class="color-head">Localidad<br></th>
						<th id="quince" class="color-head">UPZ<br></th>
						<th id="quince" class="color-head">UPR<br></th>
						<th id="quince" class="color-head">Barrio<br></th>
						<th id="quince" class="color-head">Vereda<br></th>
						<th id="diez" class="color-head">Estado<br></th>
						<th id="cinco"><div class="subir">Acción</div></th>
					</tr>
				</thead>
				<tbody>
					
				</tbody>
			</table>
		</div>

		<div class="float-right">
			<a th:href="@{/consultar_lista_compuesta}"><button type="button"
					class="boton-regresar">
					<img src="css/img/volver-over.png" class="volver" alt="Icono volver">&nbsp;&nbsp;Volver
				</button></a>
		</div>
		<br>
	</div>
	<br>
	<footer th:replace="/home:: footer"></footer>
	<div th:include="afs/listas/modal-agregar-terr.html"></div>
	<div th:include="afs/autenticacion/modal-cambiar-contrasena.html"></div>
</body>


<script th:inline="javascript">
var var_upr="";
var var_upz = "";
var var_barrio = "";
var var_vereda = "";
	$(document).ready(function() {
		
		
		 /*<![CDATA[*/
		 var mensajeRes = /*[[${messageRespuesta}]]*/;
			
		   if (mensajeRes != null){
		   Swal.fire({
				        title: 'Información',
				        text: mensajeRes,
				        icon: 'warning',
				        confirmButtonText: 'Aceptar',
				        allowOutsideClick: () => false
				    })
				    
	}
		     
		/*]]>*/
		   cargarDatos();
		   $('#dtabla tbody').on('mouseover','tr',function(){
	    	    $(this).find('.icon').find('.edit').find('.editar').attr("src","css/img/editar-rollover.png");
	    		});
	    	    $('#dtabla tbody').on('mouseleave','tr',function(){
	    	    $(this).find('.icon').find('.edit').find('.editar').attr("src","css/img/icono-1-azul.png") ;		 	 
	    		 });	
		
	});
	  function cargarDatos() {
          'use strict';
      
          /*<![CDATA[*/
 		 var ordenLista = /*[[${orden}]]*/;
          console.log(ordenLista);
      	/*]]>*/
       var opts = [{value:1, label:"Activo"},{value:0, label:"Inactivo"}];  
       $.fn.DataTable.ext.pager.numbers_length = 5;
		var table = $('#dtabla').DataTable({
			"colReorder" : true,
			"processing" : true,
			"serverSide" : true,
           "lengthChange": true,
           "searching": true,
           "ordering": true,
           "info": true,
           "autoWidth": true,
           "lengthMenu": [ [5, 10, 25, 50, -1], [5, 10,25, 50, "Mostrar Todo"] ],
           "pageLength": 5,
		    "language": {
		    	"processing": 'Cargando...',
	            "info": '<div class="formato">_END_ de _TOTAL_ registros</div>',
	            "infoEmpty": '<div class="formato">0 de 0.</div>',
	            "infoFiltered": "(filtrados de un total de _MAX_ registros)",
	            "zeroRecords": "No se han encontrado coincidencias.",
	            "responsive": true,
	            "paginate": {
	                "first": '<img src="css/img/icono-flecha-doble-izquierda.png" class="flecha-paginador">',
	                "last":  '<img src="css/img/icono-flecha-doble-derecha.png" class="flecha-paginador">',
	                "next": '<img src="css/img/icono-flecha-derecha.png" class="flecha-paginador">',
	                "previous":'<img src="css/img/icono-flecha-izquierda.png" class="flecha-paginador">'
	            },
	            "lengthMenu": "_MENU_",
	        },
	        "pagingType": "full_numbers",
	        "dom": "<'row'<'col-sm-5 col-md-7'>>" +
	        "<'row'<'col-sm-8 col-md-7'tr>>" +
	        "<'row'<'col-sm-8 col-md-7'><'col-sm-2 col-md-1'l><'col-sm-1 col-md-1'i><'col-sm-1 col-md-3'p>>",
	        "order": [0, 'desc'],
			"ajax" : {
				"url" : "/Segplan/listaTerritorializacionByPage",
				"type" : "POST"
			},
		
			"columns" : [ 
				{ data : "idTerritorializacion", className: 'derechaPresupuesto'},
				{ data : "nombreLocalidad"},
				{ data : "nombreUpz"},
				{ data : "nombreUpr"},
				{ data : "nombreBarrio"},
				{ data : "nombreVereda"},
				{ data : "stringEstado"},
			    {"render": function () {
			        return '<button href="" type="button" id="ButtonEditar" class="edit"><img src="css/img/icono-1-azul.png" class="editar"></button>';
			    }, "orderable": false, className:"icon"},
              ],
			
		})
		yadcf.init(table, [ {
			column_number : 0,
			filter_type : "text",
			filter_reset_button_text: false,
			filter_delay : 500
			
		}, {
			column_number : 1,
			filter_type : "text",
			filter_reset_button_text: false,
			filter_delay : 500
		},
		{
			column_number : 2,
			filter_type : "text",
			filter_reset_button_text: false,
			filter_delay : 500
		},
		{
			column_number : 3,
			filter_type : "text",
			filter_reset_button_text: false,
			filter_delay : 500
		},
		{
			column_number : 4,
			filter_type : "text",
			filter_reset_button_text: false,
			filter_delay : 500
		},
		{
			column_number : 5,
			filter_type : "text",
			filter_reset_button_text: false,
			filter_delay : 500
		},
		{
			data: opts,
			column_number: 6,
	        select_type: 'select',
	        filter_reset_button_text: false,
	        select_type_options: {
	            width: '150px',
	            minimumResultsForSearch: -1 // remove search box
	        }
			
		}
		]);
		$('div.dataTables_length select').addClass("formato-2");
		editar("#dtabla tbody",table);
	  }
	  function editar(tbody, table){
			$(tbody).on("click","button.edit", function(){
			    if(table.row(this).child.isShown()){
			        var data = table.row(this).data();
			    }else{
			        var data = table.row($(this).parents("tr")).data();
			    }
			    var data = table.row($(this).parents("tr")).data();
			    editarTerritorializacion(data.idTerritorializacion, data.idLsLocalidad,
			    		data.idLsUpz, data.idLsUpr, data.idLsBarrio, data.idLsVereda,
			    		data.estado)
			  })
		}
	
	function crearTerritorializacion() {
		 $('.selectpicker').removeClass('requerido');
		$('#agregarTerritorializacionModal').modal('show');
		document.getElementById("exampleModalCenterTitle").innerHTML = "Crear territorialización";
		document.getElementById("checkestado").disabled = true;

	
		var auxi = $('input:radio[name=season]:checked').val();
		if ( auxi=="upz"){
			document.getElementById("idLsUpr").disabled = true;
			document.getElementById("idLsVereda").disabled = true;
			document.getElementById("idLsUpz").disabled = false;
	 		document.getElementById("idLsBarrio").disabled = false;
		}
		

		document.getElementById("idTerritorializacion").value = null;
		document.getElementById("idLsLocalidad").value = "";
		document.getElementById("idLsUpz").value = "";
		document.getElementById("idLsUpr").value = "";
		document.getElementById("idLsBarrio").value = "";
		document.getElementById("idLsVereda").value = "";
		$("#idLsUpz").val("").trigger('change');
		$("#idLsBarrio").val("").trigger('change');
		$("#idLsVereda").val("").trigger('change');
		$("#idLsUpr").val("").trigger('change');
		$("#idLsLocalidad").val("").trigger('change');
		
		var_upz = "";
		var_upr = "";
		var_barrio = "";
		var_vereda = "";
	}
	function upzMetodo() {
		document.getElementById("idLsUpr").disabled = true;
		document.getElementById("idLsVereda").disabled = true;
		document.getElementById("idLsUpz").disabled = false;
		document.getElementById("idLsBarrio").disabled = false;
		
		document.getElementById("idLsUpr").value= "";
		document.getElementById("idLsVereda").value = "";
		
		document.getElementById("idLsUpz").value= var_upz;
		document.getElementById("idLsBarrio").value = var_barrio;
		
	}
	function uprMetodo() {
		document.getElementById("idLsUpz").disabled = true;
		document.getElementById("idLsBarrio").disabled = true;
		document.getElementById("idLsUpr").disabled = false;
		document.getElementById("idLsVereda").disabled = false;
		
		document.getElementById("idLsUpz").value = ""
		document.getElementById("idLsBarrio").value= "";
		
		document.getElementById("idLsUpr").value= var_upr;
		document.getElementById("idLsVereda").value = var_vereda;
		
	}
	function editarTerritorializacion(id, nombre, upz, upr, barrio, vereda, estado) {
		$('#agregarTerritorializacionModal').modal('show');
		$('#idTerritorializacion').text($('#idTerritorializacion').val(id));
		$('#estado').text($('#estado').val(estado));
		document.getElementById("exampleModalCenterTitle").innerHTML = "Editar territorialización";
		document.getElementById("checkestado").disabled = false;
		var est = document.getElementById("estado").value;
		
		var_upz = "";
		var_barrio = "";
		var_upr = "";
		var_vereda = "";
		if (est == 1) {
			$("input[type=checkbox]").prop("checked", true);

		} else if (est == 0) {
			$("input[type=checkbox]").prop("checked", false);
		}
    
		
		
		document.getElementById("idLsLocalidad").value = nombre;
		document.getElementById("idLsUpz").value = upz;
		document.getElementById("idLsUpr").value = upr;
		document.getElementById("idLsBarrio").value = barrio;
		document.getElementById("idLsVereda").value = vereda;
		$("#idLsUpz").val(upz).trigger('change');
		$("#idLsBarrio").val(barrio).trigger('change');
		$("#idLsVereda").val(vereda).trigger('change');
		$("#idLsUpr").val(upr).trigger('change');
		$("#idLsLocalidad").val(nombre).trigger('change');
		if (upr == -1) {
			var_upz = upz;
			var_barrio = barrio;
			document.getElementById("upz").checked = true;
			document.getElementById("upr").checked = false;
			document.getElementById("idLsUpr").disabled = true;
			document.getElementById("idLsVereda").disabled = true;
			document.getElementById("idLsUpz").disabled = false;
			document.getElementById("idLsBarrio").disabled = false;
		} else {
			var_upr = upr;
			var_vereda = vereda;
			document.getElementById("upr").checked = true;
			document.getElementById("upz").checked = false;
			document.getElementById("idLsUpz").disabled = true;
			document.getElementById("idLsBarrio").disabled = true;
			document.getElementById("idLsUpr").disabled = false;
			document.getElementById("idLsVereda").disabled = false;
		}
	
	}
</script>
<script type="text/javascript"
	th:src="@{/js/src/jquery.dataTables.yadcf.js}"></script>
<script type="text/javascript" th:src="@{/js/nhspdd/home.js}"></script>
<script type="text/javascript" th:src="@{/js/src/bootstrap.min.js}"></script>

</html>