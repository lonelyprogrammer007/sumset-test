<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head th:include="/header :: headFragment">
<meta charset="UTF-8">
<title id="pageTitle">Estructura Metas PD-Metas PI</title>
</head>
<link rel="stylesheet" type="text/css" th:href="@{/css/afs/listas.css}">
<link rel="stylesheet" type="text/css" th:href="@{/css/modal/modal.css}">
<link rel="stylesheet" type="text/css" th:href="@{/css/filtros/yadcf-listas-em.css}">
<link th:href="@{/css/modal/select2.css}" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/js/select2.min.js"></script>
<body>

	<header th:replace="/home:: header"></header>

	<nav aria-label="breadcrumb">
		<ul class="breadcrumb" id="migas">
			<li class="breadcrumb-item"><em class="fa fa-home">&nbsp;&nbsp;|&nbsp;&nbsp;</em><a
				>Administración funcional</a></li>
			<li class="breadcrumb-item">Entidades, tablas, párametros y consecutivos</li>	
			<li class="breadcrumb-item" aria-current="page"><a th:href="@{/consultar_lista_compuesta}">Listas compuestas</a></li>
			<li class="breadcrumb-item active" aria-current="page" id="act">Estructura metas PD - metas PI</li>
		</ul>
	</nav>

	<div class="form-container3">

            <div class="abs-center">
                <span>Estructura Metas PD-Metas PI</span><br>
            </div>
            <div class="hr-1"></div>
            <br>
            <div class="float-left">
                <button type="button" class="boton-agregar" onclick="crearEstructuraMeta();">
                  <img src="css/img/icono-agregar.png" class="agregar" alt="Icono agregar"> Agregar
                </button>
            </div>
            <br><br><br>
            <div class="table-responsive">
                <table id="dtabla" class="table-striped" style="width:175%">
                <caption><div class="hr-2"></div></caption>
                    <thead>
                        <tr class="color">
                            <th id="" class="color-head">Código<br></th>
                            <th id="treinta"  class="color-head">Verbo<br></th>
                            <th id="veinticinco" class="color-head">Unidad de medida<br></th>
                            <th id="diez" class="color-head">Tipo meta<br></th>
                            <th id="diez" class="color-head">Estado<br></th>
                            <th id="diez" class="subir">Acción</th>
                        </tr>
                    </thead>
                    <tbody>
				</tbody>
			</table>
		</div>
		<div class="float-right">
			<a th:href="@{/consultar_lista_compuesta}"><button type="button"
					class="boton-regresar">
					<img src="css/img/volver-over.png" class="volver" alt="Icono volver">&nbsp;&nbsp; Volver
				</button></a>
		</div>
		<br>
	</div>
	<br>
	<br>

	<footer th:replace="/home:: footer"></footer>
</body>
<div th:include="afs/listas/modal-editar-em.html"></div>
<div th:include="afs/listas/modal-agregar-em.html"></div>
<div th:include="afs/autenticacion/modal-cambiar-contrasena.html"></div>
<script type="text/javascript"></script>
 <script th:inline="javascript">
        $(document).ready(function () {
            
            /*<![CDATA[*/
   		   var mensajeRes = /*[[${messageRespuesta}]]*/;	
   		   if (mensajeRes != null){
   		   Swal.fire({
   				        title: 'Información',
   				        text: mensajeRes,
   				        icon: 'warning',
   				        confirmButtonText: 'Aceptar',
   				        allowOutsideClick: () => false
   				    })	    
   	}
   		     
   		/*]]>*/
            cargarDatos();
	

            $('#dtabla tbody').on('mouseover','tr',function(){
        	    $(this).find('.icon').find('.edit').find('.editar').attr("src","css/img/editar-rollover.png");
        		});
        	    $('#dtabla tbody').on('mouseleave','tr',function(){
        	    $(this).find('.icon').find('.edit').find('.editar').attr("src","css/img/icono-1-azul.png") ;		 	 
        		 });	

        });

	function cargarDatos(){
		'use strict';
		var opts = [{value:1, label:"Activo"},{value:0, label:"Inactivo"}];
		var opts_1 = [{value:1, label:"PD"},{value:0, label:"PI"}];
		$.fn.DataTable.ext.pager.numbers_length = 5;
		var table = $('#dtabla').DataTable({
			"colReorder" : true,
			"processing" : true,
			"serverSide" : true,
            "lengthChange": true,
            "searching": true,
            "ordering": true,
            "info": true,
            "autoWidth": true,
            "lengthMenu": [ [5, 10, 25, 50, -1], [5, 10,25, 50, "Mostrar Todo"] ],
            "pageLength": 5,
		    "language": {
		    	"processing": 'Cargando...',
	            "info": '<div class="formato">_END_ de _TOTAL_ registros</div>',
	            "infoEmpty": '<div class="formato">0 de 0.</div>',
	            "infoFiltered": "(filtrados de un total de _MAX_ registros)",
	            "zeroRecords": "No se han encontrado coincidencias.",
	            "responsive": true,
	            "paginate": {
	                "first": '<img src="css/img/icono-flecha-doble-izquierda.png" class="flecha-paginador">',
	                "last":  '<img src="css/img/icono-flecha-doble-derecha.png" class="flecha-paginador">',
	                "next": '<img src="css/img/icono-flecha-derecha.png" class="flecha-paginador">',
	                "previous":'<img src="css/img/icono-flecha-izquierda.png" class="flecha-paginador">'
	            },
	            "lengthMenu": "_MENU_",
	        },
	        "pagingType": "full_numbers",
	        "dom": "<'row'<'col-sm-5 col-md-7'>>" +
	        "<'row'<'col-sm-8 col-md-7'tr>>" +
	        "<'row'<'col-sm-8 col-md-7'><'col-sm-2 col-md-1'l><'col-sm-1 col-md-1'i><'col-sm-1 col-md-3'p>>",
	        "order": [0,'desc'],
			"ajax" : {
				"url" : "/Segplan/listaEstructuraMetaByPage",
				"type" : "POST"
			},
		
			"columns" : [ 
				{ data : "idEstructuraMetas", className: 'derechaPresupuesto'},
				{ data : "nombreVerbo"},
				{ data : "nombreUnidadMedida"},
				{ data : "stringTipo"},
				{ data : "stringEstado"},
			    {"render": function () {
			        return '<button href="" type="button" id="ButtonEditar" class="edit"><img src="css/img/icono-1-azul.png" class="editar"></button>';
			    }, "orderable": false, className:"icon"},
               ],
			
		})
		yadcf.init(table, [ {
			column_number : 0,
			filter_type : "text",
			filter_reset_button_text: false,
			filter_delay : 500
			
		}, {
			column_number : 1,
			filter_type : "text",
			filter_reset_button_text: false,
			filter_delay : 500
		},
		{
			column_number : 2,
			filter_type : "text",
			filter_reset_button_text: false,
			filter_delay : 500
		},
		{
			data: opts_1,
			column_number: 3,
	        select_type: 'select',
	        filter_reset_button_text: false,
	        select_type_options: {
	            width: '150px',
	            minimumResultsForSearch: -1 // remove search box
	        }
			
		},
		{
			data: opts,
			column_number: 4,
	        select_type: 'select',
	        filter_reset_button_text: false,
	        select_type_options: {
	            width: '150px',
	            minimumResultsForSearch: -1 // remove search box
	        }
			
		}
		]);
		$('div.dataTables_length select').addClass("formato-2");
		editar("#dtabla tbody",table);
		
	}
	function editar(tbody, table){
		$(tbody).on("click","button.edit", function(){
		    if(table.row(this).child.isShown()){
		        var data = table.row(this).data();
		    }else{
		        var data = table.row($(this).parents("tr")).data();
		    }
		    var data = table.row($(this).parents("tr")).data();
		    editarEstructuraMeta(data.idEstructuraMetas, data.idLsVerbo, data.idLsUnidadMedida,
		    		data.tipo, data.estado);
		  })
	}
	 function editarEstructuraMeta(id, verbo, medida, pd, estado) {
         $('#editarEstructuraMetaModal').modal('show');
         $('#idEstructuraMetas').text($('#idEstructuraMetas').val(id));
         document.getElementById("idLsVerbo").value = verbo;
         document.getElementById("idLsUnidadMedida").value = medida;
         document.getElementById("tipo").value = pd;
         $('#estado').text($('#estado').val(estado));
         $("#idLsVerbo").val(verbo).trigger('change');
			$("#idLsUnidadMedida").val(medida).trigger('change');
			$("#estado").val(estado).trigger('change');
         var est = document.getElementById("estado").value;
	      
 		if (est == 1) {
 			$("input[type=checkbox]").prop("checked", true);

 		} else if (est == 0) {
 			$("input[type=checkbox]").prop("checked", false);
 		}
     }
	 function crearEstructuraMeta(){
		 $('.required').removeClass('requerido');
		 document.getElementById("idLsVerboE").value = "";
		 document.getElementById("idLsUnidadMedidaE").value = "";
		 document.getElementById("tipoE").value = "";
		 $('#crearEstructuraMetaModal').modal('show');
		
	 }
	
	 
	 $('#dtabla tbody').on('mouseover','tr',function(){
		 
		 $(this).find('.icon').find('.edit').find('.editar').attr("src","img/editar-rollover.png")
 		
		 
		 
	 });
	 
	 $('#dtabla tbody').on('mouseleave','tr',function(){
		
		 $(this).find('.icon').find('.edit').find('.editar').attr("src","img/icono-1-azul.png") 		 
		 
		 
	 });
</script>
    <script type="text/javascript"
	th:src="@{/js/src/jquery.dataTables.yadcf.js}"></script>
    <script type="text/javascript" th:src="@{/js/nhspdd/home.js}"></script>
    <script type="text/javascript" th:src="@{/js/src/bootstrap.min.js}"></script>

</html>